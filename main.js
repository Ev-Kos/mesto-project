(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e){e.classList.add("popup__submit-button_inactive"),e.setAttribute("disabled","")}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t.textContent=e?"Сохранение...":n}e.d({},{DO:()=>W,XX:()=>Q,JS:()=>Y,TL:()=>R,HJ:()=>V});var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"cb3d9f20-e882-44f9-862b-5c98290433e7","Content-Type":"application/json"}},c=document.querySelector(".profile__edit-button"),u=document.querySelector("#popupProfile"),a=u.querySelector(".popup__submit-button"),i=document.querySelector("#popupPlace"),l=i.querySelector(".popup__submit-button"),s=document.querySelector("#popupZoom"),d=document.querySelector("#popupConsent"),p=d.querySelector(".popup__submit-button"),f=document.querySelector(".profile__name"),m=document.querySelector(".profile__profession"),v=document.querySelector(".profile__avatar"),_=document.querySelector("#popupUserName"),h=document.querySelector("#popupUserProfession"),y=document.querySelector(".profile__add-button"),b=document.querySelector("#popupFormProfile"),S=document.querySelector("#cardsTemplate").content,q=document.querySelector(".elements"),L=document.querySelector("#popupPlaceName"),E=document.querySelector("#popupPlaceUrl"),k=document.querySelector("#popupFormPlace"),C=document.querySelectorAll(".popup"),g=s.querySelector(".popup__image"),x=document.querySelector("#popupNewAvatar"),P=x.querySelector(".popup__submit-button"),U=document.querySelector(".profile__avatar-overlay"),A=document.querySelector("#popupFormNewAvatar"),T=document.querySelector("#popupAvatarUrl"),N=document.querySelector(".popup__caption"),O="";function w(e,t,n,o,r,c){var u=S.querySelector(".element").cloneNode(!0),a=u.querySelector(".element__image");a.src=e.link,a.alt=e.name,u.querySelector(".element__title").textContent=e.name,u.id=e._id;var i,l,s,d=u.querySelector(".element__like-button"),p=u.querySelector(".element__likes-count"),f=u.querySelector(".element__remove-button");return e.owner._id===t._id?f.addEventListener("click",(function(){o(),O=u})):f.remove(),p.textContent=e.likes.length,i=e.likes,l=t._id,s=d,i.forEach((function(e){e._id!==l||s.classList.add("element__like-button_active")})),d.addEventListener("click",(function(){d.classList.contains("element__like-button_active")?c(e._id,p,d):r(e._id,p,d)})),a.addEventListener("click",(function(){n(e.name,e.link)})),u}function D(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))}function j(e){e.classList.add("popup_opened"),document.addEventListener("keydown",B)}function J(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",B)}function B(e){"Escape"===e.key&&J(document.querySelector(".popup_opened"))}function F(e,t){g.src=t,g.alt=e,N.textContent=e,j(s)}C.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&J(e),t.target.classList.contains("popup__close-button")&&J(e)}))}));var H,X,z,M,Z,G,I,K=[];function Q(){j(d)}function R(e){q.prepend(e)}function V(e,t){f.textContent=e,m.textContent=t}function W(e,n,o){var c;(c=e,fetch("".concat(r.baseUrl,"/cards/likes/").concat(c),{method:"DELETE",headers:r.headers}).then((function(e){return t(e)}))).then((function(e){n.textContent=e.likes.length,o.classList.remove("element__like-button_active")})).catch((function(e){console.log(e)}))}function Y(e,n,o){var c;(c=e,fetch("".concat(r.baseUrl,"/cards/likes/").concat(c),{method:"PUT",headers:r.headers}).then((function(e){return t(e)}))).then((function(e){n.textContent=e.likes.length,o.classList.add("element__like-button_active")})).catch((function(e){console.log(e)}))}Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return t(e)})),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return t(e)}))]).then((function(e){if(f.textContent=e[0].name,m.textContent=e[0].about,v.src=e[0].avatar,e[1].length>0)e[1].forEach((function(t){R(w(t,e[0],F,Q,Y,W))}));else{var t=document.createElement("p");t.textContent="Извините, фотографии отсутствуют",document.querySelector(".elements").before(t)}return K=e[0]})).catch((function(e){console.log(e)})),X=(H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"}).formSelector,z=H.inputSelector,M=H.submitButtonSelector,Z=H.inactiveButtonClass,G=H.inputErrorClass,I=H.errorClass,Array.from(document.querySelectorAll(X)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,r,c){var u=Array.from(e.querySelectorAll(t)),a=e.querySelector(n);D(u,a,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector("#".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),D(u,a,o)}))}))}(e,z,M,Z,G,I)})),c.addEventListener("click",(function(){_.value=f.textContent,h.value=m.textContent,j(u)})),y.addEventListener("click",(function(){return j(i)})),b.addEventListener("submit",(function(e){var c,i;e.preventDefault(),o(!0,a),(c=_.value,i=h.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:c,about:i})}).then((function(e){return t(e)}))).then((function(e){V(_.value,h.value),J(u),n(a)})).catch((function(e){console.log(e)})).finally((function(){o(!1,a)}))})),k.addEventListener("submit",(function(e){var c,u;e.preventDefault(),c=K,u={name:L.value,link:E.value},o(!0,l),function(e){return fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t(e)}))}(u).then((function(e){R(w(e,c,F,Q,Y,W)),n(l),J(i),k.reset()})).catch((function(e){console.log(e)})).finally((function(){o(!1,l,"Создать")}))})),U.addEventListener("click",(function(){j(x)})),A.addEventListener("submit",(function(e){var c;e.preventDefault(),o(!0,P),(c=T.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:c})}).then((function(e){return t(e)}))).then((function(e){v.src=e.avatar,J(x),n(P),A.reset()})).catch((function(e){console.log(e)})).finally((function(){o(!1,P)}))})),p.addEventListener("click",(function(){var e;(e=O.id,fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return t(e)}))).then((function(){O.remove(),J(d)})).catch((function(e){console.log(e)}))}))})();