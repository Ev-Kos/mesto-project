(()=>{"use strict";var e=document.querySelector(".profile__edit-button"),t=document.querySelector("#popupProfile"),n=document.querySelector("#popupPlace"),o=document.querySelector("#popupZoom"),c=document.querySelector("#popupConsent"),r=c.querySelector(".popup__submit-button"),u=document.querySelector(".profile__name"),a=document.querySelector(".profile__profession"),i=document.querySelector(".profile__avatar"),l=document.querySelector("#popupUserName"),s=document.querySelector("#popupUserProfession"),d=document.querySelector(".profile__add-button"),p=document.querySelector("#popupFormProfile"),f=document.querySelector("#cardsTemplate").content,m=document.querySelector(".elements"),_=document.querySelector("#popupPlaceName"),v=document.querySelector("#popupPlaceUrl"),h=document.querySelector("#popupFormPlace"),y=document.querySelectorAll(".popup"),S=o.querySelector(".popup__image"),b=document.querySelector("#popupNewAvatar"),q=(b.querySelector(".popup__submit-button"),document.querySelector(".profile__avatar-edit-button")),k=document.querySelector("#popupFormNewAvatar"),L=document.querySelector("#popupAvatarUrl");function E(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function g(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))}y.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&C(e),t.target.classList.contains("popup__close-button")&&C(e)}))}));var P={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"cb3d9f20-e882-44f9-862b-5c98290433e7","Content-Type":"application/json"}},x="";function j(e,t){var n=f.querySelector(".element").cloneNode(!0),r=n.querySelector(".element__image");r.src=e.link,r.alt=e.name,n.querySelector(".element__title").textContent=e.name;var u=n.querySelector(".element__remove-button");e.owner._id===t._id?u.addEventListener("click",(function(){E(c),x=e._id,n.id="delete"})):u.remove();var a,i,l,s=n.querySelector(".element__like-button"),d=n.querySelector(".element__likes-count");return n.querySelector(".element__likes-count").textContent=e.likes.length,a=e.likes,i=t._id,l=s,a.forEach((function(e){e._id!==i||l.classList.add("element__like-button_active")})),s.addEventListener("click",(function(){s.classList.toggle("element__like-button_active"),s.classList.contains("element__like-button_active")?function(e,t){fetch("".concat(P.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:P.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}(e._id,d):function(e,t){fetch("".concat(P.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:P.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}(e._id,d)})),r.addEventListener("click",(function(){E(o),S.src=e.link,S.alt=e.name,o.querySelector(".popup__caption").textContent=e.name})),n}function U(e){m.append(e)}function A(e){var t=e.querySelector(".popup__submit-button");t.classList.add("popup__submit-button_inactive"),t.setAttribute("disabled","")}function N(e){var t=document.querySelector(".popup_opened").querySelector(".popup__submit-button");e?t.textContent="Сохранение...":t.closest(".popup__place")?t.textContent="Создать":t.textContent="Сохранить"}function T(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))}e.addEventListener("click",(function(){E(t),l.value=u.textContent,s.value=a.textContent})),p.addEventListener("submit",(function(e){var n,o;e.preventDefault(),n=l.value,o=s.value,u.textContent=n,a.textContent=o,function(e,n){fetch("".concat(P.baseUrl,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:e,about:n})}).then((function(e){return N(!0),e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)})).finally((function(){N(!1)})).finally((function(){C(t)})).finally((function(){A(t)}))}(l.value,s.value),C(t)})),d.addEventListener("click",(function(){return E(n)})),h.addEventListener("submit",(function(e){!function(e,t){fetch("".concat(P.baseUrl,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return e.ok?(N(!0),e.json()):Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){U(j(e,t))})).catch((function(e){console.log(e)})).finally((function(){N(!1)})).finally((function(){C(n)})).finally((function(){A(n)}))}({name:_.value,link:v.value},e),h.reset()})),r.addEventListener("click",(function(){var e;(e=x,void fetch("".concat(P.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:P.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).catch((function(e){console.log(e)})),C(c),document.querySelector("#delete").remove()})),q.addEventListener("click",(function(){E(b)})),k.addEventListener("submit",(function(e){var t;e.preventDefault(),t=L.value,fetch("".concat(P.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?(N(!0),e.json()):Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){i.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){N(!1)})).finally((function(){C(b)})).finally((function(){A(b)})),k.reset()}));var w,D,B,O,F,J,H,z={};fetch("".concat(P.baseUrl,"/users/me"),{headers:P.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){console.log(e)})).then((function(e){return u.textContent=e.name,a.textContent=e.about,i.src=e.avatar,z=e})).catch((function(e){console.log(e)})),fetch("".concat(P.baseUrl,"/cards"),{headers:P.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){console.log(e)})).then((function(e){e.length>0?e.forEach((function(e){U(j(e,z))})):(document.createElement("p").textContent="Извините, фотографии отсутствуют",document.querySelector(".elements").before(text))})).catch((function(e){console.log(e)})),D=(w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"}).formSelector,B=w.inputSelector,O=w.submitButtonSelector,F=w.inactiveButtonClass,J=w.inputErrorClass,H=w.errorClass,Array.from(document.querySelectorAll(D)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,c,r){var u=Array.from(e.querySelectorAll(t)),a=e.querySelector(n);T(u,a,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var c=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n),c.classList.remove(o),c.textContent=""}(e,t,n,o):function(e,t,n,o,c){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.add(o),r.textContent=n,r.classList.add(c)}(e,t,t.validationMessage,n,o)}(e,t,c,r),T(u,a,o)}))}))}(e,B,O,F,J,H)}))})();