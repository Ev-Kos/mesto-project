(()=>{"use strict";function e(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function t(e){e.classList.add("popup__submit-button_inactive"),e.setAttribute("disabled","")}function n(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t.textContent=e?"Сохранение...":n}var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"cb3d9f20-e882-44f9-862b-5c98290433e7","Content-Type":"application/json"}},r=document.querySelector(".profile__edit-button"),c=document.querySelector("#popupProfile"),u=c.querySelector(".popup__submit-button"),a=document.querySelector("#popupPlace"),i=a.querySelector(".popup__submit-button"),l=document.querySelector("#popupZoom"),s=document.querySelector("#popupConsent"),p=s.querySelector(".popup__submit-button"),d=document.querySelector(".profile__name"),f=document.querySelector(".profile__profession"),m=document.querySelector(".profile__avatar"),v=document.querySelector("#popupUserName"),_=document.querySelector("#popupUserProfession"),h=document.querySelector(".profile__add-button"),y=document.querySelector("#popupFormProfile"),b=document.querySelector("#cardsTemplate").content,S=document.querySelector(".elements"),q=(document.querySelector("#popupPlaceName"),document.querySelector("#popupPlaceUrl"),document.querySelector("#popupFormPlace")),L=document.querySelectorAll(".popup"),E=l.querySelector(".popup__image"),k=document.querySelector("#popupNewAvatar"),C=k.querySelector(".popup__submit-button"),g=document.querySelector(".profile__avatar-overlay"),P=document.querySelector("#popupFormNewAvatar"),U=document.querySelector("#popupAvatarUrl"),x=document.querySelector(".popup__caption"),A="";function N(e,t,n,o,r,c){var u=b.querySelector(".element").cloneNode(!0),a=u.querySelector(".element__image");a.src=e.link,a.alt=e.name,u.querySelector(".element__title").textContent=e.name,u.id=e._id;var i,l,s,p=u.querySelector(".element__like-button"),d=u.querySelector(".element__likes-count"),f=u.querySelector(".element__remove-button");return e.owner._id===t._id?f.addEventListener("click",(function(){o(),A=u})):f.remove(),d.textContent=e.likes.length,i=e.likes,l=t._id,s=p,i.forEach((function(e){e._id!==l||s.classList.add("element__like-button_active")})),p.addEventListener("click",(function(){p.classList.contains("element__like-button_active")?c(e._id,d,p):r(e._id,d,p)})),a.addEventListener("click",(function(){n(e.name,e.link)})),u}function T(e,t,n){e.textContent=t,n.classList.toggle("element__like-button_active")}function w(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))}function D(e){e.classList.add("popup_opened"),document.addEventListener("keydown",O)}function B(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",O)}function O(e){"Escape"===e.key&&B(document.querySelector(".popup_opened"))}var j,F,J,H,Z,z,M,G=[];function I(){D(s)}function K(e){S.prepend(e)}function Q(t,n,r){var c;(c=t,fetch("".concat(o.baseUrl,"/cards/likes/").concat(c),{method:"DELETE",headers:o.headers}).then((function(t){return e(t)}))).then((function(e){T(n,e.likes.length,r)})).catch((function(e){console.log(e)}))}function R(t,n,r){var c;(c=t,fetch("".concat(o.baseUrl,"/cards/likes/").concat(c),{method:"PUT",headers:o.headers}).then((function(t){return e(t)}))).then((function(e){T(n,e.likes.length,r)})).catch((function(e){console.log(e)}))}function V(e,t){E.src=t,E.alt=e,x.textContent=e,D(popupZoom)}Promise.all([fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(t){return e(t)})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(t){return e(t)}))]).then((function(e){if(d.textContent=e[0].name,f.textContent=e[0].about,m.src=e[0].avatar,e[1].length>0)e[1].forEach((function(t){K(N(t,e[0],V,I,R,Q))}));else{var t=document.createElement("p");t.textContent="Извините, фотографии отсутствуют",document.querySelector(".elements").before(t)}return G=e[0]})).catch((function(e){console.log(e)})),L.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&B(e),t.target.classList.contains("popup__close-button")&&B(e)}))})),F=(j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"}).formSelector,J=j.inputSelector,H=j.submitButtonSelector,Z=j.inactiveButtonClass,z=j.inputErrorClass,M=j.errorClass,Array.from(document.querySelectorAll(F)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,r,c){var u=Array.from(e.querySelectorAll(t)),a=e.querySelector(n);w(u,a,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector("#".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),w(u,a,o)}))}))}(e,J,H,Z,z,M)})),r.addEventListener("click",(function(){v.value=d.textContent,_.value=f.textContent,D(c)})),y.addEventListener("submit",(function(r){var a,i;r.preventDefault(),n(!0,u),(a=v.value,i=_.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:a,about:i})}).then((function(t){return e(t)}))).then((function(e){!function(e,t){d.textContent=e,f.textContent=t}(v.value,_.value),B(c),t(u)})).catch((function(e){console.log(e)})).finally((function(){n(!1,u)}))})),h.addEventListener("click",(function(){return D(a)})),q.addEventListener("submit",(function(r){var c,u;r.preventDefault(),c=G,u={name:popupPlaceName.value,link:popupPlaceUrl.value},n(!0,i),function(t){return fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t.name,link:t.link})}).then((function(t){return e(t)}))}(u).then((function(e){K(N(e,c,V,I,R,Q)),t(i),B(a),q.reset()})).catch((function(e){console.log(e)})).finally((function(){n(!1,i,"Создать")}))})),g.addEventListener("click",(function(){D(k)})),P.addEventListener("submit",(function(r){var c;r.preventDefault(),n(!0,C),(c=U.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:c})}).then((function(t){return e(t)}))).then((function(e){m.src=e.avatar,B(k),t(C),P.reset()})).catch((function(e){console.log(e)})).finally((function(){n(!1,C)}))})),p.addEventListener("click",(function(){var t;(t=A.id,fetch("".concat(o.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:o.headers}).then((function(t){return e(t)}))).then((function(){A.remove(),B(s)})).catch((function(e){console.log(e)}))}))})();