(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function n(e){e.classList.add("popup__submit-button_inactive"),e.setAttribute("disabled","")}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t.textContent=e?"Сохранение...":n}e.d({},{UP:()=>Q,TL:()=>R,HJ:()=>V});var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"cb3d9f20-e882-44f9-862b-5c98290433e7","Content-Type":"application/json"}},c=document.querySelector(".profile__edit-button"),u=document.querySelector("#popupProfile"),a=u.querySelector(".popup__submit-button"),i=document.querySelector("#popupPlace"),l=i.querySelector(".popup__submit-button"),s=document.querySelector("#popupZoom"),d=document.querySelector("#popupConsent"),p=d.querySelector(".popup__submit-button"),f=document.querySelector(".profile__name"),m=document.querySelector(".profile__profession"),v=document.querySelector(".profile__avatar"),_=document.querySelector("#popupUserName"),h=document.querySelector("#popupUserProfession"),y=document.querySelector(".profile__add-button"),b=document.querySelector("#popupFormProfile"),S=document.querySelector("#cardsTemplate").content,q=document.querySelector(".elements"),L=document.querySelector("#popupPlaceName"),E=document.querySelector("#popupPlaceUrl"),k=document.querySelector("#popupFormPlace"),C=document.querySelectorAll(".popup"),g=s.querySelector(".popup__image"),P=document.querySelector("#popupNewAvatar"),x=P.querySelector(".popup__submit-button"),U=(document.querySelector(".profile__avatar-edit-button"),document.querySelector("#popupFormNewAvatar")),A=document.querySelector("#popupAvatarUrl"),T=document.querySelector(".popup__caption"),N="";function w(e,n,o,c){var u=S.querySelector(".element").cloneNode(!0),a=u.querySelector(".element__image");a.src=e.link,a.alt=e.name,u.querySelector(".element__title").textContent=e.name,u.id=e._id;var i,l,s,d=u.querySelector(".element__like-button"),p=u.querySelector(".element__likes-count"),f=u.querySelector(".element__remove-button");return e.owner._id===n._id?f.addEventListener("click",(function(){c(),N=u})):f.remove(),p.textContent=e.likes.length,i=e.likes,l=n._id,s=d,i.forEach((function(e){e._id!==l||s.classList.add("element__like-button_active")})),d.addEventListener("click",(function(){var n;d.classList.contains("element__like-button_active")?(n=e._id,fetch("".concat(r.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:r.headers}).then((function(e){return t(e)}))).then((function(e){p.textContent=e.likes.length,d.classList.remove("element__like-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return t(e)}))}(e._id).then((function(e){p.textContent=e.likes.length,d.classList.add("element__like-button_active")})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){o(e.name,e.link)})),u}function O(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))}function D(e){e.classList.add("popup_opened"),document.addEventListener("keydown",B)}function j(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",B)}function B(e){"Escape"===e.key&&j(document.querySelector(".popup_opened"))}function J(e,t){g.src=t,g.alt=e,T.textContent=e,D(s)}C.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&j(e),t.target.classList.contains("popup__close-button")&&j(e)}))}));var F,H,z,M,Z,G,I,K=[];function Q(){D(d)}function R(e){q.prepend(e)}function V(e,t){f.textContent=e,m.textContent=t}Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then((function(e){return t(e)})),fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then((function(e){return t(e)}))]).then((function(e){if(f.textContent=e[0].name,m.textContent=e[0].about,v.src=e[0].avatar,e[1].length>0)e[1].forEach((function(t){R(w(t,e[0],J,Q))}));else{var t=document.createElement("p");t.textContent="Извините, фотографии отсутствуют",document.querySelector(".elements").before(t)}return K=e[0]})).catch((function(e){console.log(e)})),H=(F={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"}).formSelector,z=F.inputSelector,M=F.submitButtonSelector,Z=F.inactiveButtonClass,G=F.inputErrorClass,I=F.errorClass,Array.from(document.querySelectorAll(H)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,r,c){var u=Array.from(e.querySelectorAll(t)),a=e.querySelector(n);O(u,a,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector("#".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector("#".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(e,t,r,c),O(u,a,o)}))}))}(e,z,M,Z,G,I)})),c.addEventListener("click",(function(){_.value=f.textContent,h.value=m.textContent,D(u)})),y.addEventListener("click",(function(){return D(i)})),b.addEventListener("submit",(function(e){var c,i;e.preventDefault(),o(!0,a),(c=_.value,i=h.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:c,about:i})}).then((function(e){return t(e)}))).then((function(e){V(_.value,h.value),j(u),n(a)})).catch((function(e){console.log(e)})).finally((function(){o(!1,a)}))})),k.addEventListener("submit",(function(e){var c,u;e.preventDefault(),c=K,u={name:L.value,link:E.value},o(!0,l),function(e){return fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return t(e)}))}(u).then((function(e){R(w(e,c,J,Q)),n(l),j(i),k.reset()})).catch((function(e){console.log(e)})).finally((function(){o(!1,l,"Создать")}))})),document.querySelector(".profile__avatar-overlay").addEventListener("click",(function(){D(P)})),U.addEventListener("submit",(function(e){var c;e.preventDefault(),o(!0,x),(c=A.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:c})}).then((function(e){return t(e)}))).then((function(e){v.src=e.avatar,j(P),n(x),U.reset()})).catch((function(e){console.log(e)})).finally((function(){o(!1,x)}))})),p.addEventListener("click",(function(){var e;(e=N.id,fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return t(e)}))).then((function(){N.remove(),j(d)})).catch((function(e){console.log(e)}))}))})();